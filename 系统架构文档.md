# 黄金价格预测系统架构文档

## 1. 系统架构

### 1.1 整体架构

黄金价格预测系统采用前后端分离的架构设计，主要由以下几个部分组成：

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  前端页面   │     │  Flask后端  │     │  数据模块   │
│  (HTML/CSS) │◄────┤   API服务   │◄────┤  (Python)   │
└─────────────┘     └─────────────┘     └─────────────┘
                                      ┌─────────────┐
                                      │  数据缓存   │
                                      └─────────────┘
```

### 1.2 核心模块

| 模块名称 | 文件路径 | 主要功能 |
|---------|---------|--------|
| 后端服务 | `backend.py` | 提供API接口，协调各模块工作 |
| 数据获取 | `data_fetcher.py` | 获取黄金价格数据 |
| 技术分析 | `technical_analysis.py` | 计算技术指标 |
| 情绪分析 | `sentiment_analysis.py` | 分析市场情绪 |
| 价格预测 | `predictor.py` | 预测黄金价格 |
| 配置管理 | `config.py` | 管理系统配置 |

### 1.3 数据流

1. **数据获取**：通过`data_fetcher.py`从多个数据源获取黄金价格数据
2. **数据处理**：
   - 计算技术指标（`technical_analysis.py`）
   - 分析市场情绪（`sentiment_analysis.py`）
3. **价格预测**：使用机器学习模型预测黄金价格（`predictor.py`）
4. **数据缓存**：将处理后的数据缓存，提高系统响应速度
5. **API服务**：通过Flask提供RESTful API接口，供前端调用
6. **前端展示**：展示价格数据、技术指标、情绪分析和预测结果

## 2. 数据来源

### 2.1 价格数据来源

系统从以下数据源获取黄金价格数据：

| 数据源 | 类型 | 描述 |
|-------|------|------|
| 新浪财经 | 实时 | 提供实时黄金价格数据 |
| AkShare | 历史 | 提供COMEX黄金历史数据 |
| Kitco | 历史 | 提供黄金价格历史数据 |
| Investing.com | 历史 | 提供黄金价格历史数据 |
| Alpha Vantage | 历史/实时 | 提供黄金价格数据（需要API密钥） |
| Finnhub | 历史/实时 | 提供黄金价格数据（需要API密钥） |
| YFinance | 历史/实时 | 提供黄金价格数据 |

### 2.2 新闻数据来源

系统从以下数据源获取黄金相关新闻，用于情绪分析：

| 数据源 | 描述 |
|-------|------|
| 东方财富 | 提供黄金相关新闻 |
| 金十数据 | 提供黄金相关快讯 |
| 新浪财经 | 提供黄金相关新闻 |
| 央视新闻 | 提供黄金相关新闻 |

### 2.3 数据缓存

系统使用本地文件缓存获取到的真实数据，缓存配置如下：

- 缓存目录：`data_cache`
- 缓存文件：`gold_price_cache.csv`
- 缓存过期时间：24小时

## 3. 系统功能

### 3.1 核心功能

| 功能名称 | 描述 | API接口 |
|---------|------|---------|
| 实时价格查询 | 获取黄金实时价格 | `/api/realtime` |
| 历史价格分析 | 获取黄金历史价格数据 | `/api/price` |
| 技术指标计算 | 计算各种技术指标 | `/api/technical` |
| 市场情绪分析 | 分析黄金市场情绪 | `/api/sentiment` |
| 价格预测 | 预测未来黄金价格 | `/api/predictions` |
| 支撑阻力位分析 | 分析黄金价格支撑阻力位 | `/api/support-resistance` |
| 系统摘要 | 获取系统整体状态 | `/api/summary` |
| 数据刷新 | 手动刷新系统数据 | `/api/refresh` |

### 3.2 技术指标

系统计算的技术指标包括：

| 指标名称 | 描述 |
|---------|------|
| 移动平均线 | SMA和EMA，包括5日、10日、20日、50日、200日 |
| RSI | 相对强弱指标，判断超买超卖 |
| MACD | 移动平均收敛发散指标，判断趋势 |
| 布林带 | 波动率指标，判断价格区间 |
| 随机指标 | KDJ指标，判断价格动量 |
| ATR | 平均真实范围，衡量波动率 |
| 综合信号 | 基于多个指标的综合交易信号 |

### 3.3 情绪分析

系统通过以下方式分析市场情绪：

1. **新闻情绪分析**：分析黄金相关新闻的情绪倾向
2. **情绪词典**：使用金融领域的正面和负面词汇进行情绪分析
3. **恐惧贪婪指数**：基于价格波动计算市场恐惧贪婪程度
4. **情绪趋势**：分析情绪的变化趋势

### 3.4 价格预测

系统使用以下机器学习模型进行价格预测：

| 模型名称 | 描述 | 权重 |
|---------|------|------|
| 随机森林 | 集成学习模型，适合非线性数据 | 0.4 |
| 梯度提升 | 集成学习模型，预测精度高 | 0.4 |
| 线性回归 | 基础模型，提供稳定预测 | 0.2 |

预测功能包括：
- 未来7天价格预测
- 预测趋势判断（看涨/看跌/中性）
- 预测置信区间计算
- 基于情绪的预测调整

## 4. 系统特点

### 4.1 数据可靠性

- **多数据源**：从多个权威数据源获取数据，确保数据可靠性
- **智能降级**：当一个数据源失败时，自动尝试其他数据源
- **数据缓存**：缓存真实数据，减少API调用，提高系统响应速度

### 4.2 分析准确性

- **综合技术分析**：结合多种技术指标，提供更全面的市场分析
- **情绪分析**：分析市场情绪，为预测提供额外参考
- **机器学习**：使用多种机器学习模型，提高预测准确性

### 4.3 系统稳定性

- **错误处理**：完善的错误处理机制，确保系统稳定运行
- **后台更新**：后台线程定期更新数据，确保数据时效性
- **智能填充**：当数据不足时，智能填充缺失值，避免系统崩溃

## 5. 系统配置

### 5.1 配置文件

系统使用`.env`文件进行配置，主要配置项包括：

| 配置项 | 描述 | 默认值 |
|-------|------|-------|
| `GOLD_TICKER` | 黄金交易代码 | `XAUUSD` |
| `HISTORICAL_DAYS` | 历史数据天数 | 365 |
| `PREDICTION_DAYS` | 预测天数 | 7 |
| `UPDATE_INTERVAL_HOURS` | 数据更新间隔（小时） | 1 |
| `SENTIMENT_THRESHOLD` | 情绪阈值 | 0.1 |
| `ALPHA_VANTAGE_KEY` | Alpha Vantage API密钥 | `demo` |
| `FINNHUB_KEY` | Finnhub API密钥 | `` |

### 5.2 环境依赖

系统依赖以下Python库：

- Flask：Web框架
- pandas：数据处理
- numpy：数值计算
- scikit-learn：机器学习
- ta：技术分析
- requests：HTTP请求
- bs4：HTML解析
- akshare：金融数据获取

## 6. 部署与运行

### 6.1 本地运行

1. 安装依赖：`pip install -r requirements.txt`
2. 配置`.env`文件
3. 启动服务：`python backend.py`
4. 访问前端：`http://localhost:5000`

### 6.2 服务状态

- 后端服务默认运行在`http://localhost:5000`
- API接口可通过`http://localhost:5000/api/{endpoint}`访问
- 后台线程每小时更新一次数据

## 7. 未来优化方向

1. **数据源扩展**：添加更多数据源，提高数据可靠性
2. **模型优化**：使用更复杂的机器学习模型，提高预测准确性
3. **前端优化**：改进前端界面，提供更丰富的可视化功能
4. **实时分析**：增加实时数据分析能力，提高系统响应速度
5. **风险评估**：添加风险评估功能，为投资决策提供参考

## 8. 总结

黄金价格预测系统是一个综合性的金融分析工具，通过多数据源获取数据，结合技术分析和机器学习模型，为用户提供黄金价格的预测和分析。系统采用模块化设计，具有良好的可扩展性和稳定性，能够满足用户对黄金市场分析的基本需求。